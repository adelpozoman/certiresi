<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">


<!--    <script src="qr-scanner.umd.min.js"></script>-->

    <script>
        function submitForm(city, code) {
            let data = {
                city: city,
                code: code.data
            };

            var xhr = new XMLHttpRequest();
            xhr.open('POST', '/submit', true);
            xhr.setRequestHeader('Content-Type', 'application/json'); // Set the content type to JSON
            xhr.onload = function() {
                if (xhr.status >= 200 && xhr.status < 300) {
                    var responseData = JSON.parse(xhr.responseText);
                    // Update page based on response
                    //document.getElementById('result').innerText = responseData.message;
                    console.log(responseData);
                } else {
                    console.error('Request failed with status code ' + xhr.status);
                }
            };
            xhr.onerror = function() {
                console.error('Request failed');
            };

            // Convert the data object to JSON and send it in the request body
            xhr.send(JSON.stringify(data));
        }


    </script>




<script>
        //open phone camera
    function camera() {
        // Get the video element
        var video = document.createElement('video');
        video.setAttribute('autoplay', '');
        video.setAttribute('playsinline', '');

        // Get user media
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(function(stream) {
                video.srcObject = stream;
            })
            .catch(function(error) {
                console.error('getUserMedia error:', error);
            });

        // Replace the futureCamera div with the video element
        var futureCameraDiv = document.getElementById('futureCamera');
        futureCameraDiv.replaceWith(video);



        import('/qr-scanner.min.js').then((module) => {
            const QrScanner = module.default;
            // do something with QrScanner
            const qrScanner = new QrScanner(
                video,
                result => {
                    console.log('decoded qr code:', result);
                    qrScanner.stop();
                    //destroy futureCameraDiv
                    futureCameraDiv.remove();
                    submitForm("santJoan", result);
                },
                { /* your options or returnDetailedScanResult: true if you're not specifying any other options */ },
            );
            qrScanner.start();


        });



    }


</script>


</head>
<body>

<div id="master" style="height: 100vh; background-color: rgba(255,0,0,0.1);">
    <div class="card w-100 h-50 text-center border rounded" style=";" id="futureCamera" onclick="camera()">
        <div class="card-body">
            <h5 class="card-title">Special title treatment</h5>
            <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
            <a href="#" class="btn btn-primary">Go somewhere</a>
        </div>
    </div>
    <div class="card w-100 h-50 text-center border rounded" style=";">
        <div class="card-body">
            <h5 class="card-title">Special title treatment</h5>
            <p class="card-text">With supporting text below as a natural lead-in to additional content.</p>
            <a href="#" class="btn btn-primary">Go somewhere</a>
        </div>
    </div>


</div>




<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>